{% extends 'base.html' %}
{% load staticfiles %}
{% load render_table from django_tables2 %}

{% block heading %}
    <h3><span class="fa fa-circle-o"></span> Coins</h3>
{% endblock %}

{% block content %}

    <div class="container-fluid">
        {% if sticky_message %}
            <div class="alert alert-info alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                {{ sticky_message.message|safe }}
            </div>
        {% endif %}
        <!-- chart area -->
        {# TODO create carousel for multiple currencies #}
        <div class="row">
            <div class="container-fluid">
                <div id="bitcoinChart" class="card-body"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            {% render_table cryptocurrency %}
        </div>
    </div>
{% endblock %}

{% block extrahead %}

    <!-- HighCharts/Highstocks js-->
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
{% endblock %}

{% block extrajs %}

    <script type="text/javascript">
        $(document).ready(function () {

            // Glucose Average by Day chart
            var bitcoinChartOptions = {
                credits: {enabled: false},
                chart: {
                    renderTo: 'bitcoinChart',
                    type: 'line',
                },
                legend: {enabled: false},
                title: {text: 'Bitcoin Chart'},
                subtitle: {text: 'Last 14 Days'},
                xAxis: {
                    title: {text: null},
                    labels: {rotation: -45}
                },
                yAxis: {title: {text: null}},
                series: [{
                    animation: false
                }]
            };

            // set the url to the chart_data_json view
            var chartDataUrl = "{% url 'coinsChartDataJson' %}";
            // if you want to add additional parameters such as name, or days, add this at the end
            //var ?name=avg_by_day&days=14";

            // pull data from the chart_data_json view and add it to the chart
            $.getJSON(chartDataUrl, function (data) {
                bitcoinChartOptions.series[0].name = 'Avg Glucose ({{ user.settings.glucose_unit }})';
                bitcoinChartOptions.series[0].data = data['chart_data'];

                new Highcharts.stockChart(bitcoinChartOptions);
            });
        });
    </script>
{% endblock %}